<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ICD Cost Estimator™</title>

  <!-- Meta -->
  <meta name="description" content="Planning-level budgeting tool for Insulated Concrete Domes (ICD). All client-side; no data leaves your browser." />
  <meta name="theme-color" content="#001f3f" />

  <!-- Styles -->
  <link rel="stylesheet" href="./icdce.css" />
  <style>
    /* Sticky action bar (always visible on mobile) */
    #icdce ._stickybar{
      position:sticky; bottom:0; z-index:50; inset-inline:0;
      display:flex; gap:10px; justify-content:space-between; align-items:center;
      padding:10px 12px; background:rgba(255,255,255,.96); backdrop-filter:saturate(1.2) blur(6px);
      border-top:1px solid var(--border-color);
    }
    #icdce ._stickybar ._btn{ flex:1 1 auto; }
    #icdce ._stickybar ._btn._good._unlocked{
      box-shadow:0 0 0 2px rgba(52,168,83,.35) inset;
    }

    /* Little “unlocked” toast */
    #icdce #icdce_unlocked{
      position:fixed; left:50%; transform:translateX(-50%) translateY(10px);
      top:10px; z-index:60; padding:10px 14px; border-radius:999px;
      background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0;
      font:500 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      display:none; align-items:center; gap:10px; box-shadow:0 10px 20px rgba(0,0,0,.08);
    }
    #icdce #icdce_unlocked._show{ display:flex; animation: slideDown .35s ease-out; }
    @keyframes slideDown{
      from{ transform:translateX(-50%) translateY(-14px); opacity:0; }
      to{ transform:translateX(-50%) translateY(10px); opacity:1; }
    }

    /* Make option rows friendlier on phones */
    ._inline._inline-wrap label{ margin-right:8px; }
    ._inline._inline-stack{ flex-direction:column; align-items:flex-start; }
  </style>
</head>
<body>
  <div id="icdce">
    <!-- Unlock toast (auto shown after Stripe success) -->
    <div id="icdce_unlocked" aria-live="polite" role="status">
      <!-- simple checkmark -->
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M20 6L9 17l-5-5" stroke="#065f46" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      PDF export unlocked — tap “Export PDF”.
    </div>

    <div class="_wrap">
      <!-- Brand bar -->
      <div class="_brandbar _wrap-mobile">
        <div class="_brandleft _wrap-mobile">
          <div class="_mark">ICD Cost Estimator<span>™</span></div>
          <div class="_tagline">Planning-level budgeting for Insulated Concrete Domes</div>
        </div>
        <span class="_pill">Client-side • No data leaves your browser</span>
      </div>

      <div class="_panel" role="region" aria-label="ICD Cost Estimator">
        <!-- Project Basics -->
        <div class="_section _project-basics">
          <h2 class="_sectionTitle">Project Basics</h2>
          <div class="_grid">
            <div class="_field">
              <label class="_label" for="ce_sf">Conditioned SF</label>
              <input id="ce_sf" class="_input" type="number" min="0" step="50" placeholder="e.g., 2000" />
              <div class="_hint">Total conditioned square footage.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_region">Region</label>
              <select id="ce_region" class="_input">
                <option value="1.00">Standard (1.00)</option>
                <option value="0.90">Low-cost (0.90)</option>
                <option value="1.15">High-cost metro (1.15)</option>
                <option value="1.30">Very high (1.30)</option>
              </select>
              <div class="_hint">Rural/smaller markets → Low-cost; coastal/big metros → Very high.</div>
            </div>

            <div class="_field _wide">
              <label class="_label" for="ce_regionIdx">Region Cost Index (fine-tune)</label>
              <div class="_inline">
                <input id="ce_regionIdx" class="_input" type="range" min="0.80" max="1.40" step="0.01" value="1.00" list="ce_regionTicks" />
                <span class="_badge" id="ce_regionIdxVal">1.00</span>
              </div>
              <datalist id="ce_regionTicks">
                <option value="0.80"></option><option value="0.90"></option><option value="1.00"></option>
                <option value="1.10"></option><option value="1.20"></option><option value="1.30"></option><option value="1.40"></option>
              </datalist>
              <div class="_ticks"><span>0.80</span><span>0.90</span><span>1.00</span><span>1.10</span><span>1.20</span><span>1.30</span><span>1.40</span></div>
              <div class="_hint">Slide until Base Shell $/SF roughly matches your recent jobs.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_diameter">Dome Diameter (ft)</label>
              <input id="ce_diameter" class="_input" type="number" min="20" step="1" placeholder="e.g., 50" />
              <div class="_hint">Used for planning-level checks.</div>
            </div>
          </div>
        </div>

        <!-- Design & Envelope -->
        <div class="_section _design-envelope">
          <h2 class="_sectionTitle">Design &amp; Envelope</h2>
          <div class="_grid">
            <div class="_field">
              <label class="_label" for="ce_finish">Finish Level</label>
              <select id="ce_finish" class="_input">
                <option value="0.95">Basic (durable &amp; simple)</option>
                <option value="1.00" selected>Standard (balanced)</option>
                <option value="1.20">Premium (upgraded surfaces)</option>
                <option value="1.35">Luxury (custom &amp; high-end)</option>
              </select>
              <div class="_hint">Affects interior & allowances (not the base shell).</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_domes"># of Domes</label>
              <select id="ce_domes" class="_input">
                <option value="1">1 (single)</option>
                <option value="2">2 (compound)</option>
                <option value="3">3+</option>
              </select>
              <div class="_hint">More domes → more interfaces/openings; slightly higher cost.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_height">Shell Height</label>
              <select id="ce_height" class="_input">
                <option value="std">Standard</option>
                <option value="tall">Tall (+ loft potential)</option>
              </select>
              <div class="_hint">Tall shells add staging time and reinforcement complexity.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_glazing">Glazing % of Envelope</label>
              <select id="ce_glazing" class="_input">
                <option value="0.10">~10% (minimal)</option>
                <option value="0.20" selected>~20% (typical)</option>
                <option value="0.30">~30% (bright)</option>
                <option value="0.40">~40% (panoramic)</option>
              </select>
              <div class="_hint">Higher % adds both glazing SF and unit cost.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_basement">Basement</label>
              <select id="ce_basement" class="_input">
                <option value="none">None (slab)</option>
                <option value="partial">Partial</option>
                <option value="full">Full</option>
              </select>
              <div class="_hint">Adds excavation, walls, slab, stairs, and egress where required.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_shellThk">Shell Concrete Thickness (inches)</label>
              <select id="ce_shellThk" class="_input">
                <option value="4">4″ (standard)</option>
                <option value="5">5″</option>
                <option value="6">6″</option>
              </select>
              <div class="_hint">Thicker shell for higher wind/seismic.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_mixType">Shotcrete / Mix Type</label>
              <select id="ce_mixType" class="_input">
                <option value="std">Standard Portland</option>
                <option value="pozz">Pozzolan (volcanic ash) blend</option>
                <option value="hemp">Hempcrete (experimental)</option>
              </select>
              <div class="_hint">Alters material cost; consult engineer.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_oculusCount">Oculus / Skylight Count</label>
              <input id="ce_oculusCount" class="_input" type="number" min="0" step="1" value="0" />
            </div>

            <div class="_field">
              <label class="_label" for="ce_connector">Connector / Tunnel</label>
              <select id="ce_connector" class="_input">
                <option value="none">None</option>
                <option value="short">Short (≤10 ft)</option>
                <option value="med">Medium (11–25 ft)</option>
                <option value="long">Long (25+ ft)</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Site & Systems -->
        <div class="_section _site-systems">
          <h2 class="_sectionTitle">Site &amp; Systems</h2>
          <div class="_grid">
            <div class="_field">
              <label class="_label" for="ce_baths">Bathrooms</label>
              <select id="ce_baths" class="_input">
                <option value="1">1 bath</option>
                <option value="2" selected>2 baths</option>
                <option value="3">3 baths</option>
                <option value="4">4 baths</option>
                <option value="5">5+ baths</option>
              </select>
              <div class="_hint">Adjusts plumbing/electrical fixture density and small systems.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_site">Site Difficulty</label>
              <select id="ce_site" class="_input">
                <option value="flat">Flat &amp; clear</option>
                <option value="moderate">Moderate slopes/trees</option>
                <option value="complex">Steep/rocky or long access</option>
              </select>
              <div class="_hint">Harder sites need more excavation time, access work, equipment.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_mep">MEP Complexity</label>
              <select id="ce_mep" class="_input">
                <option value="simple">Simple</option>
                <option value="standard" selected>Standard</option>
                <option value="advanced">Advanced (zoning/HRV)</option>
              </select>
              <div class="_hint">Mechanical first, then Electrical and Plumbing sophistication.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_remote">Remoteness / Access</label>
              <select id="ce_remote" class="_input">
                <option value="easy">Easy (paved &amp; close)</option>
                <option value="moderate">Moderate</option>
                <option value="remote">Remote (long access / off-grid)</option>
              </select>
            </div>

            <div class="_field">
              <label class="_label" for="ce_inflationPower">Inflation Power</label>
              <select id="ce_inflationPower" class="_input">
                <option value="onsite">On-site power</option>
                <option value="generator">Generator</option>
              </select>
            </div>

            <div class="_field _wide">
              <label class="_label" for="ce_incSitework">Include Sitework &amp; Rough Grading</label>
              <div class="_inline">
                <input type="checkbox" id="ce_incSitework" />
                <span>Include sitework in estimate</span>
              </div>
              <div class="_hint">Toggle to include sitework costs.</div>
            </div>

            <div class="_field">
              <label class="_label" for="ce_lightning">Lightning Protection</label>
              <div class="_inline">
                <input type="checkbox" id="ce_lightning" />
                <span>Lightning protection / grounding</span>
              </div>
            </div>

            <div class="_field _wide">
              <label class="_label">Optional Systems</label>
              <div class="_inline _inline-wrap">
                <label><input type="checkbox" id="ce_optSolar" /> Solar PV (+$20k)</label>
                <label><input type="checkbox" id="ce_optStorage" /> Battery Storage (+$18k)</label>
                <label><input type="checkbox" id="ce_optGeo" /> Geothermal (+$45k)</label>
                <label><input type="checkbox" id="ce_optRain" /> Rainwater collection / cistern (+$12k)</label>
                <label><input type="checkbox" id="ce_optSeptic" /> Septic (+$35k)</label>
                <label><input type="checkbox" id="ce_optHydronic" /> Hydronic radiant floors (+$20k)</label>
              </div>
              <div class="_hint">Planning-level adders you can toggle on/off.</div>
            </div>

            <div class="_field _wide">
              <label class="_label">Driveway (optional)</label>
              <div class="_inline _inline-stack">
                <label><input type="checkbox" id="ce_optDriveway" /> Include driveway</label>
                <input id="ce_driveLen" class="_input" type="number" min="0" max="150" step="5" value="100" />
              </div>
              <div class="_hint">Length in feet (0–150). Budget uses ~ $80/ft × region × site.</div>
            </div>
          </div>
        </div>

        <!-- Contingency Only -->
        <div class="_section _soft-cont">
          <h2 class="_sectionTitle">Contingency</h2>
          <div class="_grid">
            <div class="_field">
              <label class="_label" for="ce_contPct">Contingency %</label>
              <input id="ce_contPct" class="_input" type="number" min="0" max="100" step="0.1" value="10" />
              <div class="_hint">Common planning allowance is 5–15% depending on risk.</div>
            </div>
            <div class="_field _full">
              <div class="_inline _actions-mobile">
                <button id="ce_calcBtn" class="_btn" type="button">Calculate</button>
                <button id="ce_clearBtn" class="_btn _secondary" type="button">Clear</button>
                <button id="ce_printBtn" class="_btn _good" type="button">Export PDF</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Results -->
        <div class="_results-pad">
          <div class="_cards">
            <div class="_card">
              <h3>Estimated Range</h3>
              <div class="_big" id="ce_rangeTotal">$0 – $0</div>
              <div class="_small" id="ce_rangePerSf">$/SF: $0 – $0</div>
            </div>
            <div class="_card">
              <h3>Base Dome Shell (Airform, Foam, Rebar, Shotcrete)</h3>
              <div class="_big" id="ce_baseTotal">$0</div>
              <div class="_small" id="ce_basePsf">$/SF: $0</div>
            </div>
            <div class="_card">
              <h3>Sitework &amp; Rough Grading</h3>
              <div class="_big" id="ce_siteworkTotal">$0 – $0</div>
              <div class="_small" id="ce_siteworkNote">Included</div>
            </div>
            <div class="_card" style="grid-column:1 / -1;">
              <h3>Assumptions</h3>
              <div class="_small" id="ce_assumptions">Region 1.00 • Standard finish • Typical glazing • Single dome</div>
            </div>
          </div>

          <h3 class="_results-title">Line-Item Breakdown</h3>
          <div class="_panel _breakdown">
            <table>
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Description</th>
                  <th class="_right">Low</th>
                  <th class="_right">High</th>
                </tr>
              </thead>
              <tbody id="ce_breakdown">
                <tr>
                  <td colspan="4" class="_muted" style="text-align:center;padding:18px">
                    Run a calculation to see details.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="_disclaimer">
            <strong>Important:</strong> Planning-level estimate only (not a bid). Final costs depend on site, engineering, and trade bids.
          </div>
        </div>
      </div>
    </div>

    <!-- Sticky action bar (always visible) -->
    <div class="_stickybar" id="icdce_sticky" role="region" aria-label="Quick actions">
      <button class="_btn" type="button" onclick="document.getElementById('ce_calcBtn')?.click()">Calculate</button>
      <button class="_btn _good" type="button" onclick="document.getElementById('ce_printBtn')?.click()" id="icdce_export_quick">
        Export PDF
      </button>
    </div>

    <!-- Paywall Modal -->
    <div id="icdce_paywall" class="_modalBackdrop" aria-hidden="true">
      <div class="_modal" role="dialog" aria-modal="true" aria-labelledby="pw_title">
        <h3 id="pw_title">Export PDF</h3>
        <p>Exporting a formatted, two-page PDF is a paid feature. Complete checkout and you’ll be returned here automatically.</p>
        <div class="_row _actions-mobile">
          <button id="pw_payBtn" class="_btn _good" type="button">Go to Checkout</button>
          <button id="pw_closeBtn" class="_btn _secondary" type="button">Close</button>
        </div>
        <hr style="border:none;border-top:1px solid #e5e7eb;margin:14px 0;">
        <p style="margin-bottom:6px;">Already paid? Enter your access code or use a paid return link.</p>
        <div class="_codeRow _inline _inline-stack">
          <input id="pw_code" class="_input" type="text" placeholder="Access code (optional)" />
          <button id="pw_apply" class="_btn" type="button">Apply Code</button>
        </div>
        <div id="pw_msg" class="_hint" style="margin-top:8px;"></div>
      </div>
    </div>
  </div>

  <!-- App JS -->
  <script src="./icdce.js"></script>

  <!-- Tiny helper: show “unlocked” toast + highlight Export button after Stripe return -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // IMPORTANT: this must match STORE_KEY in icdce.js
      var STORE_KEY = 'icdce_paid_test1d';

      try {
        var unlocked = (localStorage.getItem(STORE_KEY) === 'yes');
        if (unlocked) {
          // Show toast
          var toast = document.getElementById('icdce_unlocked');
          if (toast) {
            toast.classList.add('_show');
            setTimeout(function(){ toast.classList.remove('_show'); }, 4200);
          }
          // Subtle highlight on sticky Export
          var quick = document.getElementById('icdce_export_quick');
          if (quick) {
            quick.classList.add('_unlocked');
            setTimeout(function(){ quick.classList.remove('_unlocked'); }, 5000);
          }
          // Ensure quick action bar is in view (in case user is mid-page)
          var sticky = document.getElementById('icdce_sticky');
          if (sticky && sticky.scrollIntoView) {
            sticky.scrollIntoView({ behavior: 'smooth', block: 'end' });
          }
        }
      } catch (e) { /* ignore */ }
    });
  </script>

  <noscript>Please enable JavaScript to use the ICD Cost Estimator.</noscript>
</body>
</html>
